window.log=function(){window.logDebugging&&console.log.apply(console,arguments)};var canvas=window.canvas=function(a){return{setMouseCoordinates:function(b){a.xm=b.x,a.ym=b.y},mapToMouse:function(b){var c=(b.x-a.snake.xx)*a.gsc,d=(b.y-a.snake.yy)*a.gsc;return{x:c,y:d}},mapToCanvas:function(b){var c={x:a.mww2+(b.x-a.view_xx)*a.gsc,y:a.mhh2+(b.y-a.view_yy)*a.gsc};return c},circleMapToCanvas:function(b){var c=canvas.mapToCanvas({x:b.x,y:b.y});return canvas.circle(c.x,c.y,b.radius*a.gsc)},point:function(a,b){var c={x:Math.round(a),y:Math.round(b)};return c},rect:function(a,b,c,d){var e={x:Math.round(a),y:Math.round(b),width:Math.round(c),height:Math.round(d)};return e},circle:function(a,b,c){var d={x:Math.round(a),y:Math.round(b),radius:Math.round(c)};return d},fastAtan2:function(a,b){const c=Math.PI/4,d=3*Math.PI/4;var e=0,f=0,g=Math.abs(a)+1e-10;return b<0?(e=(b+g)/(g-b),f=d):(e=(b-g)/(b+g),f=c),f+=(.1963*e*e-.9817)*e,a<0?-f:f},setZoom:function(b){a.gsc&&(a.gsc*=Math.pow(.9,b.wheelDelta/-120||b.detail/2||0),a.desired_gsc=a.gsc)},resetZoom:function(){a.gsc=.9,a.desired_gsc=.9},maintainZoom:function(){void 0!==a.desired_gsc&&(a.gsc=a.desired_gsc)},setBackground:function(b){b="undefined"!=typeof b?b:"/s/bg45.jpg",a.ii.src=b},drawRect:function(b,c,d,e){void 0===e&&(e=1);var f=a.mc.getContext("2d"),g=canvas.mapToCanvas({x:b.x,y:b.y});f.save(),f.globalAlpha=e,f.strokeStyle=c,f.rect(g.x,g.y,b.width*a.gsc,b.height*a.gsc),f.stroke(),d&&(f.fillStyle=c,f.fill()),f.restore()},drawCircle:function(b,c,d,e){void 0===e&&(e=1),void 0===b.radius&&(b.radius=5);var f=a.mc.getContext("2d"),g=canvas.circleMapToCanvas(b);f.save(),f.globalAlpha=e,f.beginPath(),f.strokeStyle=c,f.arc(g.x,g.y,g.radius,0,2*Math.PI),f.stroke(),d&&(f.fillStyle=c,f.fill()),f.restore()},drawAngle:function(b,c,d,e,f){void 0===f&&(f=.6);var g=a.mc.getContext("2d");g.save(),g.globalAlpha=f,g.beginPath(),g.moveTo(a.mc.width/2,a.mc.height/2),g.arc(a.mc.width/2,a.mc.height/2,100*a.gsc,b,c),g.lineTo(a.mc.width/2,a.mc.height/2),g.closePath(),g.stroke(),e&&(g.fillStyle=d,g.fill()),g.restore()},drawLine:function(b,c,d,e){void 0===e&&(e=5);var f=a.mc.getContext("2d"),g=canvas.mapToCanvas(b),h=canvas.mapToCanvas(c);f.save(),f.beginPath(),f.lineWidth=e*a.gsc,f.strokeStyle=d,f.moveTo(g.x,g.y),f.lineTo(h.x,h.y),f.stroke(),f.restore()},isLeft:function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)>0},getDistance2:function(a,b,c,d){var e=Math.pow(a-c,2)+Math.pow(b-d,2);return e},getDistance2FromSnake:function(b){return b.distance=canvas.getDistance2(a.snake.xx,a.snake.yy,b.xx,b.yy),b},unitVector:function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return b>0?{x:a.x/b,y:a.y/b}:{x:0,y:0}},pointInRect:function(a,b){return b.x<=a.x&&b.y<=a.y&&b.x+b.width>=a.x&&b.y+b.height>=a.y},pointInPoly:function(a,b){if(a.x<b.minx||a.x>b.maxx||a.y<b.miny||a.y>b.maxy)return!1;var c=!1;const d=b.pts.length;for(var e=0,f=d-1;e<d;f=e++)b.pts[e].y>a.y!=b.pts[f].y>a.y&&a.x<(b.pts[f].x-b.pts[e].x)*(a.y-b.pts[e].y)/(b.pts[f].y-b.pts[e].y)+b.pts[e].x&&(c=!c);return c},addPolyBox:function(a){for(var b=a.pts[0].x,c=a.pts[0].x,d=a.pts[0].y,e=a.pts[0].y,f=1,g=a.pts.length;f<g;f++)a.pts[f].x<b&&(b=a.pts[f].x),a.pts[f].x>c&&(c=a.pts[f].x),a.pts[f].y<d&&(d=a.pts[f].y),a.pts[f].y>e&&(e=a.pts[f].y);return{pts:a.pts,minx:b,maxx:c,miny:d,maxy:e}},cross:function(a,b,c){return(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)},convexHullSort:function(a,b){return a.x==b.x?a.y-b.y:a.x-b.x},convexHull:function(a){a.sort(canvas.convexHullSort);for(var b=[],c=0,d=a.length;c<d;c++){for(;b.length>=2&&canvas.cross(b[b.length-2],b[b.length-1],a[c])<=0;)b.pop();b.push(a[c])}for(var e=[],c=a.length-1;c>=0;c--){for(;e.length>=2&&canvas.cross(e[e.length-2],e[e.length-1],a[c])<=0;)e.pop();e.push(a[c])}return e.pop(),b.pop(),b.concat(e)},circleIntersect:function(b,c){var d=b.radius+c.radius,e={};if(b.x+d>c.x&&b.y+d>c.y&&b.x<c.x+d&&b.y<c.y+d){var f=canvas.getDistance2(b.x,b.y,c.x,c.y);if(f<d*d){if(e={x:(b.x*c.radius+c.x*b.radius)/d,y:(b.y*c.radius+c.y*b.radius)/d,ang:0},e.ang=canvas.fastAtan2(e.y-a.snake.yy,e.x-a.snake.xx),a.visualDebugging){var g=canvas.circle(e.x,e.y,5);canvas.drawCircle(c,"#ff9900",!1),canvas.drawCircle(g,"#66ff66",!0)}return e}}return!1}}}(window),bot=window.bot=function(a){return{isBotRunning:!1,isBotEnabled:!0,lookForFood:!1,collisionPoints:[],collisionAngles:[],foodAngles:[],scores:[],foodTimeout:void 0,sectorBoxSide:0,defaultAccel:0,sectorBox:{},currentFood:{},opt:{targetFps:30,arcSize:Math.PI/8,radiusMult:10,foodAccelSz:200,foodAccelDa:Math.PI/2,foodFrames:2,foodDelay:15,speedBase:5.78,frontAngle:Math.PI/2,enCircleThreshold:.5625,enCircleAllThreshold:.5625,enCircleDistanceMult:20,followCircleLength:5e3},MID_X:0,MID_Y:0,MAP_R:0,MAXARC:0,getSnakeWidth:function(b){return void 0===b&&(b=a.snake.sc),Math.round(29*b)},quickRespawn:function(){a.dead_mtm=0,a.login_fr=0,bot.isBotRunning=!1,a.forcing=!0,bot.connect(),a.forcing=!1},connect:function(){a.force_ip&&a.force_port&&a.forceServer(a.force_ip,a.force_port),a.connect()},angleBetween:function(a,b){var c=0,d=0;return c=(a-b)%Math.PI,d=(b-a)%Math.PI,c<d?-c:d},changeHeadingAbs:function(b){var c=Math.cos(b),d=Math.sin(b);a.goalCoordinates={x:Math.round(a.snake.xx+bot.headCircle.radius*c),y:Math.round(a.snake.yy+bot.headCircle.radius*d)},canvas.setMouseCoordinates(canvas.mapToMouse(a.goalCoordinates))},changeHeadingRel:function(b){var c={x:a.snake.xx+500*bot.cos,y:a.snake.yy+500*bot.sin},d=Math.cos(-b),e=Math.sin(-b);a.goalCoordinates={x:Math.round(d*(c.x-a.snake.xx)-e*(c.y-a.snake.yy)+a.snake.xx),y:Math.round(e*(c.x-a.snake.xx)+d*(c.y-a.snake.yy)+a.snake.yy)},canvas.setMouseCoordinates(canvas.mapToMouse(a.goalCoordinates))},headingBestAngle:function(){var b,c,e,d=[],f=bot.getAngleIndex(a.snake.ehang)+bot.MAXARC/2;f>bot.MAXARC&&(f-=bot.MAXARC);for(var g=0;g<bot.MAXARC;g++)void 0===bot.collisionAngles[g]?(c=0,void 0===e&&(e=g)):(c=bot.collisionAngles[g].distance,e&&(d.push({openStart:e,openEnd:g-1,sz:g-1-e}),e=void 0)),(void 0===b||b.distance<c&&0!==b.distance)&&(b={distance:c,aIndex:g});e&&d[0]?(d[0].openStart=e,d[0].sz=d[0].openEnd-e,d[0].sz<0&&(d[0].sz+=bot.MAXARC)):e&&d.push({openStart:e,openEnd:e,sz:0}),d.length>0?(d.sort(bot.sortSz),bot.changeHeadingAbs((d[0].openEnd-d[0].sz/2)*bot.opt.arcSize)):bot.changeHeadingAbs(b.aIndex*bot.opt.arcSize)},avoidCollisionPoint:function(b,c){(void 0===c||c>Math.PI)&&(c=Math.PI);var d={x:a.snake.xx+2e3*bot.cos,y:a.snake.yy+2e3*bot.sin};a.visualDebugging&&(canvas.drawLine({x:a.snake.xx,y:a.snake.yy},d,"orange",5),canvas.drawLine({x:a.snake.xx,y:a.snake.yy},{x:b.x,y:b.y},"red",5)),canvas.isLeft({x:a.snake.xx,y:a.snake.yy},d,{x:b.x,y:b.y})?bot.changeHeadingAbs(b.ang-c):bot.changeHeadingAbs(b.ang+c)},getAngleIndex:function(a){var b;return a<0&&(a+=2*Math.PI),b=Math.round(a*(1/bot.opt.arcSize)),b===bot.MAXARC?0:b},addCollisionAngle:function(b){var c=canvas.fastAtan2(Math.round(b.yy-a.snake.yy),Math.round(b.xx-a.snake.xx)),d=bot.getAngleIndex(c),e=Math.round(Math.pow(Math.sqrt(b.distance)-b.radius,2));(void 0===bot.collisionAngles[d]||bot.collisionAngles[d].distance>b.distance)&&(bot.collisionAngles[d]={x:Math.round(b.xx),y:Math.round(b.yy),ang:c,snake:b.snake,distance:e,radius:b.radius,aIndex:d})},addFoodAngle:function(b){var c=canvas.fastAtan2(Math.round(b.yy-a.snake.yy),Math.round(b.xx-a.snake.xx)),d=bot.getAngleIndex(c);canvas.getDistance2FromSnake(b),(void 0===bot.collisionAngles[d]||Math.sqrt(bot.collisionAngles[d].distance)>Math.sqrt(b.distance)+bot.snakeRadius*bot.opt.radiusMult*bot.speedMult/2)&&(void 0===bot.foodAngles[d]?bot.foodAngles[d]={x:Math.round(b.xx),y:Math.round(b.yy),ang:c,da:Math.abs(bot.angleBetween(c,a.snake.ehang)),distance:b.distance,sz:b.sz,score:Math.pow(b.sz,2)/b.distance}:(bot.foodAngles[d].sz+=Math.round(b.sz),bot.foodAngles[d].score+=Math.pow(b.sz,2)/b.distance,bot.foodAngles[d].distance>b.distance&&(bot.foodAngles[d].x=Math.round(b.xx),bot.foodAngles[d].y=Math.round(b.yy),bot.foodAngles[d].distance=b.distance)))},getCollisionPoints:function(){var b;bot.collisionPoints=[],bot.collisionAngles=[];for(var c=0,d=a.snakes.length;c<d;c++)if(b=void 0,a.snakes[c].id!==a.snake.id&&1===a.snakes[c].alive_amt){var e=a.snakes[c],f=bot.getSnakeWidth(e.sc)/2,g=Math.min(1,e.sp/5.78-1);b={xx:e.xx+Math.cos(e.ehang)*f*g*bot.opt.radiusMult/2,yy:e.yy+Math.sin(e.ehang)*f*g*bot.opt.radiusMult/2,snake:c,radius:bot.headCircle.radius,head:!0},canvas.getDistance2FromSnake(b),bot.addCollisionAngle(b),bot.collisionPoints.push(b),a.visualDebugging&&canvas.drawCircle(canvas.circle(b.xx,b.yy,b.radius),"red",!1),b=void 0;for(var h=0,i=e.pts.length;h<i;h++)if(!e.pts[h].dying&&canvas.pointInRect({x:e.pts[h].xx,y:e.pts[h].yy},bot.sectorBox)){var j={xx:e.pts[h].xx,yy:e.pts[h].yy,snake:c,radius:f};a.visualDebugging,1,canvas.getDistance2FromSnake(j),bot.addCollisionAngle(j),j.distance<=Math.pow(bot.headCircle.radius+j.radius,2)&&(bot.collisionPoints.push(j),a.visualDebugging&&canvas.drawCircle(canvas.circle(j.xx,j.yy,j.radius),"red",!1))}}if(canvas.getDistance2(bot.MID_X,bot.MID_Y,a.snake.xx,a.snake.yy)>Math.pow(bot.MAP_R-1e3,2)){var k=canvas.fastAtan2(a.snake.yy-bot.MID_X,a.snake.xx-bot.MID_Y);b={xx:bot.MID_X+bot.MAP_R*Math.cos(k),yy:bot.MID_Y+bot.MAP_R*Math.sin(k),snake:-1,radius:bot.snakeWidth},canvas.getDistance2FromSnake(b),bot.collisionPoints.push(b),bot.addCollisionAngle(b),a.visualDebugging&&canvas.drawCircle(canvas.circle(b.xx,b.yy,b.radius),"yellow",!1)}if(bot.collisionPoints.sort(bot.sortDistance),a.visualDebugging)for(var l=0;l<bot.collisionAngles.length;l++)void 0!==bot.collisionAngles[l]&&canvas.drawLine({x:a.snake.xx,y:a.snake.yy},{x:bot.collisionAngles[l].x,y:bot.collisionAngles[l].y},"red",2)},inFrontAngle:function(b){var c=canvas.fastAtan2(Math.round(b.y-a.snake.yy),Math.round(b.x-a.snake.xx));return Math.abs(bot.angleBetween(c,a.snake.ehang))<bot.opt.frontAngle},checkCollision:function(){var b;if(bot.getCollisionPoints(),0===bot.collisionPoints.length)return!1;for(var c=0;c<bot.collisionPoints.length;c++){var d=canvas.circle(bot.collisionPoints[c].xx,bot.collisionPoints[c].yy,bot.collisionPoints[c].radius);if((b=canvas.circleIntersect(bot.headCircle,d))&&bot.inFrontAngle(b))return bot.collisionPoints[c].snake!==-1&&bot.collisionPoints[c].head&&a.snakes[bot.collisionPoints[c].snake].sp>10?a.setAcceleration(1):a.setAcceleration(bot.defaultAccel),bot.avoidCollisionPoint(b),!0}return a.setAcceleration(bot.defaultAccel),!1},checkEncircle:function(){for(var b=[],c=0,d=0,e=0;e<bot.collisionAngles.length;e++)if(void 0!==bot.collisionAngles[e]){var f=bot.collisionAngles[e].snake;b[f]?b[f]++:b[f]=1,b[f]>c&&(c=b[f]),bot.collisionAngles[e].distance<Math.pow(bot.snakeRadius*bot.opt.enCircleDistanceMult,2)&&d++}return c>bot.MAXARC*bot.opt.enCircleThreshold?(bot.headingBestAngle(),c!==bot.MAXARC&&a.setAcceleration(1),a.visualDebugging&&canvas.drawCircle(canvas.circle(a.snake.xx,a.snake.yy,bot.opt.radiusMult*bot.snakeRadius),"red",!0,.2),!0):d>bot.MAXARC*bot.opt.enCircleAllThreshold?(bot.headingBestAngle(),a.setAcceleration(bot.defaultAccel),a.visualDebugging&&canvas.drawCircle(canvas.circle(a.snake.xx,a.snake.yy,bot.snakeRadius*bot.opt.enCircleDistanceMult),"yellow",!0,.2),!0):(a.visualDebugging&&canvas.drawCircle(canvas.circle(a.snake.xx,a.snake.yy,bot.snakeRadius*bot.opt.enCircleDistanceMult),"yellow"),a.setAcceleration(bot.defaultAccel),!1)},bodyDangerZone:function(b,c,d,e,f,g){var h={x:a.snake.xx,y:a.snake.yy},i=[{x:h.x-b*bot.sin,y:h.y+b*bot.cos},{x:h.x+bot.snakeWidth*bot.cos+b*(bot.cos-bot.sin),y:h.y+bot.snakeWidth*bot.sin+b*(bot.sin+bot.cos)},{x:h.x+1.75*bot.snakeWidth*bot.cos+.3*bot.snakeWidth*bot.sin+b*(bot.cos-bot.sin),y:h.y+1.75*bot.snakeWidth*bot.sin-.3*bot.snakeWidth*bot.cos+b*(bot.sin+bot.cos)},{x:h.x+2.5*bot.snakeWidth*bot.cos+.7*bot.snakeWidth*bot.sin+b*(bot.cos-bot.sin),y:h.y+2.5*bot.snakeWidth*bot.sin-.7*bot.snakeWidth*bot.cos+b*(bot.sin+bot.cos)},{x:h.x+3*bot.snakeWidth*bot.cos+1.2*bot.snakeWidth*bot.sin+b*bot.cos,y:h.y+3*bot.snakeWidth*bot.sin-1.2*bot.snakeWidth*bot.cos+b*bot.sin},{x:bot.pts[c].x+d.x*(b+.5*Math.max(e,0)),y:bot.pts[c].y+d.y*(b+.5*Math.max(e,0))},{x:bot.pts[f].x+d.x*b,y:bot.pts[f].y+d.y*b},bot.pts[f],bot.pts[c],bot.pts[g]];i=canvas.convexHull(i);var j={pts:i};return j=canvas.addPolyBox(j)},followCircleSelf:function(){bot.pts=[];for(var b=a.snake.pts.length-1;b>=0;b--)a.snake.pts[b].dying||bot.pts.push({x:a.snake.pts[b].xx,y:a.snake.pts[b].yy,len:0});bot.len=0;for(var c=1;c<bot.pts.length;c++)bot.len+=Math.sqrt(canvas.getDistance2(bot.pts[c-1].x,bot.pts[c-1].y,bot.pts[c].x,bot.pts[c].y)),bot.pts[c].len=bot.len;for(var d={x:a.snake.xx,y:a.snake.yy},e=-1,f=-1,c=bot.pts.length-2;c>=0&&bot.pts[c].len>8*bot.snakeWidth;c--){var g=canvas.getDistance2(d.x,d.y,bot.pts[c].x,bot.pts[c].y);(f<0||g<f)&&(f=g,e=c)}if(!(e<0)){for(var h=e;h>0&&bot.pts[e].len-bot.pts[h].len<bot.snakeWidth;)h--;var i=canvas.unitVector({x:bot.pts[h].x-bot.pts[e].x,y:bot.pts[h].y-bot.pts[e].y}),j={x:-i.y,y:i.x};f=j.x*(d.x-bot.pts[e].x)+j.y*(d.y-bot.pts[e].y);for(var k=bot.pts.length,l=0;bot.pts[l].len<5*bot.snakeWidth&&l<k-1;)l++;for(var m=0;bot.pts[m].len-bot.pts[e].len<5*bot.snakeWidth&&m<k-1;)m++;for(var n=canvas.addPolyBox({pts:bot.pts.slice(l,1+m)}),o=.5*bot.snakeWidth+Math.max(0,f)+1.25*bot.snakeWidth*Math.max(0,bot.cos*j.x+bot.sin*j.y),p=e;p>0&&bot.pts[e].len-bot.pts[p].len<.5*o;)p--;if(0!=p&&p!=bot.pts.length-1){for(var q=canvas.unitVector({x:-bot.pts[p-1].y+bot.pts[p+1].y,y:bot.pts[p-1].x-bot.pts[p+1].x}),r=p;r>0&&bot.pts[p].len-bot.pts[r].len<3*bot.snakeWidth;)r--;var s=.25*bot.snakeWidth,t={x:bot.pts[p].x,y:bot.pts[p].y,r:3*o,r2:0};t.r2=t.r*t.r;for(var u=4096*bot.snakeWidth*bot.snakeWidth,v=0,w=a.snakes.length;v<w;v++)if(a.snakes[v].id!==a.snake.id&&1===a.snakes[v].alive_amt){var x={x:a.snakes[v].xx,y:a.snakes[v].yy},y={x:a.snakes[v].xx+Math.cos(a.snakes[v].ang)*bot.snakeWidth,y:a.snakes[v].yy+Math.sin(a.snakes[v].ang)*bot.snakeWidth};canvas.pointInPoly(x,n)||(u=Math.min(u,canvas.getDistance2(x.x,x.y,t.x,t.y),canvas.getDistance2(y.x,y.y,t.x,t.y)));for(var z=!1,A=0,B={},b=0,C=a.snakes[v].pts.length;b<C;b++)if(!a.snakes[v].pts[b].dying)for(var D={x:a.snakes[v].pts[b].xx,y:a.snakes[v].pts[b].yy};!z||s>=-bot.snakeWidth&&canvas.pointInPoly(D,B);)z?s-=.0625*bot.snakeWidth:z=!0,A=.5*(bot.snakeWidth+bot.getSnakeWidth(a.snakes[v].sc))+s,B=bot.bodyDangerZone(A,p,q,f,r,e)}var E=Math.sqrt(u);if(a.visualDebugging)for(var c=0,F=n.pts.length;c<F;c++){var G=c+1;G==F&&(G=0),canvas.drawLine({x:n.pts[c].x,y:n.pts[c].y},{x:n.pts[G].x,y:n.pts[G].y},"orange")}if(a.visualDebugging&&canvas.drawCircle(canvas.circle(bot.pts[e].x,bot.pts[e].y,.25*bot.snakeWidth),"white",!1),a.visualDebugging&&(canvas.drawCircle(canvas.circle(t.x,t.y,t.r),"white",!1),canvas.drawCircle(canvas.circle(t.x,t.y,.2*bot.snakeWidth),"white",!1)),a.visualDebugging)for(var H=.5*bot.snakeWidth,I=bot.bodyDangerZone(H,p,q,f,r,e),c=0,F=I.pts.length;c<F;c++){var G=c+1;G==F&&(G=0),canvas.drawLine({x:I.pts[c].x,y:I.pts[c].y},{x:I.pts[G].x,y:I.pts[G].y},"white")}var J=Math.asin(Math.max(-1,Math.min(1,bot.cos*j.x+bot.sin*j.y))),K=J+.25,L=-(t.r-E)/bot.snakeWidth;L=L>0?.125*L*L:-.5*L*L,K=Math.min(K,L),K=Math.min(K,K+(s-.0625*bot.snakeWidth)/bot.snakeWidth);var M=bot.len-bot.pts[e].len,N=canvas.unitVector({x:bot.MID_X-d.x,y:bot.MID_Y-d.y}),O=N.x*j.x+N.y*j.y,P=bot.snakeWidth*(2-.5*O);a.visualDebugging&&canvas.drawLine({x:d.x,y:d.y},{x:d.x+P*N.x,y:d.y+P*N.y},"red"),K=Math.min(K,(M-P+.5*(bot.snakeWidth-f))/bot.snakeWidth),K=Math.min(K,-.5*(f-4*bot.snakeWidth)/bot.snakeWidth),K=Math.max(K,-.75*f/bot.snakeWidth),K=Math.min(K,1);var Q={x:i.x*Math.cos(K)-i.y*Math.sin(K),y:i.y*Math.cos(K)+i.x*Math.sin(K)},R={x:d.x+4*Q.x*bot.snakeWidth,y:d.y+4*Q.y*bot.snakeWidth};a.goalCoordinates&&Math.abs(R.x-a.goalCoordinates.x)<1e3&&Math.abs(R.y-a.goalCoordinates.y)<1e3?a.goalCoordinates={x:Math.round(.25*R.x+.75*a.goalCoordinates.x),y:Math.round(.25*R.y+.75*a.goalCoordinates.y)}:a.goalCoordinates={x:Math.round(R.x),y:Math.round(R.y)},canvas.setMouseCoordinates(canvas.mapToMouse(a.goalCoordinates))}}},sortScore:function(a,b){return b.score-a.score},sortSz:function(a,b){return b.sz-a.sz},sortDistance:function(a,b){return a.distance-b.distance},computeFoodGoal:function(){bot.foodAngles=[];for(var b=0;b<a.foods.length&&null!==a.foods[b];b++){var c=a.foods[b];c.eaten||canvas.circleIntersect(canvas.circle(c.xx,c.yy,2),bot.sidecircle_l)||canvas.circleIntersect(canvas.circle(c.xx,c.yy,2),bot.sidecircle_r)||bot.addFoodAngle(c)}bot.foodAngles.sort(bot.sortScore),void 0!==bot.foodAngles[0]&&bot.foodAngles[0].sz>0?bot.currentFood={x:bot.foodAngles[0].x,y:bot.foodAngles[0].y,sz:bot.foodAngles[0].sz,da:bot.foodAngles[0].da}:bot.currentFood={x:bot.MID_X,y:bot.MID_Y,sz:0}},foodAccel:function(){var a=0;if(bot.currentFood&&bot.currentFood.sz>bot.opt.foodAccelSz){if(a=bot.getAngleIndex(bot.currentFood.ang),bot.collisionAngles[a]&&bot.collisionAngles[a].distance>bot.currentFood.distance+bot.snakeRadius*bot.opt.radiusMult&&bot.currentFood.da<bot.opt.foodAccelDa)return 1;if(void 0===bot.collisionAngles[a]&&bot.currentFood.da<bot.opt.foodAccelDa)return 1}return bot.defaultAccel},every:function(){bot.MID_X=a.grd,bot.MID_Y=a.grd,bot.MAP_R=.98*a.grd,bot.MAXARC=2*Math.PI/bot.opt.arcSize,bot.sectorBoxSide=Math.floor(Math.sqrt(a.sectors.length))*a.sector_size,bot.sectorBox=canvas.rect(a.snake.xx-bot.sectorBoxSide/2,a.snake.yy-bot.sectorBoxSide/2,bot.sectorBoxSide,bot.sectorBoxSide),bot.cos=Math.cos(a.snake.ang),bot.sin=Math.sin(a.snake.ang),bot.speedMult=a.snake.sp/bot.opt.speedBase,bot.snakeRadius=bot.getSnakeWidth()/2,bot.snakeWidth=bot.getSnakeWidth(),bot.snakeLength=Math.floor(15*(a.fpsls[a.snake.sct]+a.snake.fam/a.fmlts[a.snake.sct]-1)-5),bot.headCircle=canvas.circle(a.snake.xx+bot.cos*Math.min(1,bot.speedMult-1)*bot.opt.radiusMult/2*bot.snakeRadius,a.snake.yy+bot.sin*Math.min(1,bot.speedMult-1)*bot.opt.radiusMult/2*bot.snakeRadius,bot.opt.radiusMult/2*bot.snakeRadius),a.visualDebugging&&canvas.drawCircle(bot.headCircle,"blue",!1),bot.sidecircle_r=canvas.circle(a.snake.lnp.xx-(a.snake.lnp.yy+bot.sin*bot.snakeWidth-a.snake.lnp.yy),a.snake.lnp.yy+(a.snake.lnp.xx+bot.cos*bot.snakeWidth-a.snake.lnp.xx),bot.snakeWidth*bot.speedMult),bot.sidecircle_l=canvas.circle(a.snake.lnp.xx+(a.snake.lnp.yy+bot.sin*bot.snakeWidth-a.snake.lnp.yy),a.snake.lnp.yy-(a.snake.lnp.xx+bot.cos*bot.snakeWidth-a.snake.lnp.xx),bot.snakeWidth*bot.speedMult)},go:function(){bot.every(),bot.snakeLength>bot.opt.followCircleLength?(a.setAcceleration(bot.defaultAccel),bot.followCircleSelf()):bot.checkCollision()||bot.checkEncircle()?(bot.lookForFood=!1,bot.foodTimeout&&(a.clearTimeout(bot.foodTimeout),bot.foodTimeout=a.setTimeout(bot.foodTimer,1e3/bot.opt.targetFps*bot.opt.foodDelay))):(bot.lookForFood=!0,void 0===bot.foodTimeout&&(bot.foodTimeout=a.setTimeout(bot.foodTimer,1e3/bot.opt.targetFps*bot.opt.foodFrames)),a.setAcceleration(bot.foodAccel()))},foodTimer:function(){a.playing&&bot.lookForFood&&null!==a.snake&&1===a.snake.alive_amt&&(bot.computeFoodGoal(),a.goalCoordinates=bot.currentFood,canvas.setMouseCoordinates(canvas.mapToMouse(a.goalCoordinates))),bot.foodTimeout=void 0}}}(window),userInterface=window.userInterface=function(a,b){var c=b.onkeydown,d=a.onmousedown,e=a.oef,f=a.redraw,g=a.onmousemove;return a.oef=function(){},a.redraw=function(){},{overlays:{},initServerIp:function(){var a=b.getElementById("playh"),c=b.createElement("div"),d=b.createElement("input");c.style.width="244px",c.style.margin="-30px auto",c.style.boxShadow="rgb(0, 0, 0) 0px 6px 50px",c.style.opacity=1,c.style.background="rgb(76, 68, 124)",c.className="taho",c.style.display="block",d.className="sumsginp",d.placeholder="0.0.0.0:444",d.maxLength=21,d.style.width="220px",d.style.height="24px",c.appendChild(d),a.appendChild(c),userInterface.server=d},initOverlays:function(){var a=b.createElement("div");a.style.position="fixed",a.style.right="5px",a.style.bottom="112px",a.style.width="150px",a.style.height="85px",a.style.color="#C0C0C0",a.style.fontFamily="Consolas, Verdana",a.style.zIndex=999,a.style.fontSize="14px",a.style.padding="5px",a.style.borderRadius="5px",a.className="nsi",b.body.appendChild(a);var c=b.createElement("div");c.style.position="fixed",c.style.right="5px",c.style.bottom="5px",c.style.width="160px",c.style.height="14px",c.style.color="#C0C0C0",c.style.fontFamily="Consolas, Verdana",c.style.zIndex=999,c.style.fontSize="14px",c.className="nsi",b.body.appendChild(c);var d=b.createElement("div");d.style.position="fixed",d.style.left="10px",d.style.top="75px",d.style.width="260px",d.style.height="210px",d.style.color="#C0C0C0",d.style.fontFamily="Consolas, Verdana",d.style.zIndex=999,d.style.fontSize="14px",d.style.padding="5px",d.style.borderRadius="5px",d.className="nsi",b.body.appendChild(d);var e=b.createElement("div");e.style.position="fixed",e.style.left="10px",e.style.top="295px",e.style.width="140px",e.style.height="210px",e.style.color="#C0C0C0",e.style.fontFamily="Consolas, Verdana",e.style.zIndex=998,e.style.fontSize="14px",e.style.padding="5px",e.style.borderRadius="5px",e.className="nsi",b.body.appendChild(e),userInterface.overlays.botOverlay=a,userInterface.overlays.serverOverlay=c,userInterface.overlays.prefOverlay=d,userInterface.overlays.statsOverlay=e},toggleOverlays:function(){Object.keys(userInterface.overlays).forEach(function(b){var c="hidden"!==userInterface.overlays[b].style.visibility?"hidden":"visible";userInterface.overlays[b].style.visibility=c,a.visualDebugging="visible"===c})},savePreference:function(b,c){a.localStorage.setItem(b,c),userInterface.onPrefChange()},loadPreference:function(b,c){var d=a.localStorage.getItem(b);return null!==d?("true"===d?a[b]=!0:"false"===d?a[b]=!1:a[b]=d,a.log("Setting found for "+b+": "+a[b])):(a[b]=c,a.log("No setting found for "+b+". Used default: "+a[b])),userInterface.onPrefChange(),a[b]},playButtonClickListener:function(){if(userInterface.saveNick(),userInterface.loadPreference("autoRespawn",!1),userInterface.onPrefChange(),userInterface.server.value){var b=userInterface.server.value.split(":");2===b.length&&(a.force_ip=b[0],a.force_port=b[1],bot.connect())}else a.force_ip=void 0,a.force_port=void 0},saveNick:function(){var a=b.getElementById("nick").value;userInterface.savePreference("savedNick",a)},hideTop:function(){for(var c=b.querySelectorAll("div.nsi"),d=0;d<c.length;d++)"4px"===c[d].style.top&&"300px"===c[d].style.width&&(c[d].style.visibility="hidden",bot.isTopHidden=!0,a.topscore=c[d])},framesPerSecond:{fps:0,fpsTimer:function(){a.playing&&a.fps&&a.lrd_mtm&&Date.now()-a.lrd_mtm>970&&(userInterface.framesPerSecond.fps=a.fps)}},onkeydown:function(b){c(b),a.playing&&(84===b.keyCode&&(bot.isBotEnabled=!bot.isBotEnabled),85===b.keyCode&&(a.logDebugging=!a.logDebugging,console.log("Log debugging set to: "+a.logDebugging),userInterface.savePreference("logDebugging",a.logDebugging)),89===b.keyCode&&(a.visualDebugging=!a.visualDebugging,console.log("Visual debugging set to: "+a.visualDebugging),userInterface.savePreference("visualDebugging",a.visualDebugging)),73===b.keyCode&&(a.autoRespawn=!a.autoRespawn,console.log("Automatic Respawning set to: "+a.autoRespawn),userInterface.savePreference("autoRespawn",a.autoRespawn)),72===b.keyCode&&userInterface.toggleOverlays(),79===b.keyCode&&userInterface.toggleMobileRendering(!a.mobileRender),65===b.keyCode&&(bot.opt.radiusMult++,console.log("radiusMult set to: "+bot.opt.radiusMult)),83===b.keyCode&&bot.opt.radiusMult>1&&(bot.opt.radiusMult--,console.log("radiusMult set to: "+bot.opt.radiusMult)),90===b.keyCode&&canvas.resetZoom(),81===b.keyCode&&(a.autoRespawn=!1,userInterface.quit()),27===b.keyCode&&bot.quickRespawn(),userInterface.onPrefChange())},onmousedown:function(b){if(a.playing)switch(b.which){case 1:bot.defaultAccel=1,bot.isBotEnabled||d(b);break;case 3:bot.isBotEnabled=!bot.isBotEnabled}else d(b);userInterface.onPrefChange()},onmouseup:function(){bot.defaultAccel=0},toggleMobileRendering:function(b){a.mobileRender=b,a.log("Mobile rendering set to: "+a.mobileRender),userInterface.savePreference("mobileRender",a.mobileRender),a.mobileRender?(a.render_mode=1,a.want_quality=0,a.high_quality=!1):(a.render_mode=2,a.want_quality=1,a.high_quality=!0)},updateStats:function(){var b,a=[];if(0!==bot.scores.length){b=Math.round((bot.scores[Math.floor((bot.scores.length-1)/2)]+bot.scores[Math.ceil((bot.scores.length-1)/2)])/2),a.push("games played: "+bot.scores.length),a.push("a: "+Math.round(bot.scores.reduce(function(a,b){return a+b})/bot.scores.length)+" m: "+b);for(var c=0;c<bot.scores.length&&c<10;c++)a.push(c+1+". "+bot.scores[c]);userInterface.overlays.statsOverlay.innerHTML=a.join("<br/>")}},onPrefChange:function(){var b=[],c=userInterface.handleTextColor;b.push("version: "+GM_info.script.version),b.push("[T] bot: "+c(bot.isBotEnabled)),b.push("[O] mobile rendering: "+c(a.mobileRender)),b.push("[A/S] radius multiplier: "+bot.opt.radiusMult),b.push("[I] auto respawn: "+c(a.autoRespawn)),b.push("[Y] visual debugging: "+c(a.visualDebugging)),b.push("[U] log debugging: "+c(a.logDebugging)),b.push("[Mouse Wheel] zoom"),b.push("[Z] reset zoom"),b.push("[ESC] quick respawn"),b.push("[Q] quit to menu"),userInterface.overlays.prefOverlay.innerHTML=b.join("<br/>")},onFrameUpdate:function(){var b=[];if(a.playing&&null!==a.snake&&(b.push("fps: "+userInterface.framesPerSecond.fps),b.push("x: "+(Math.round(a.snake.xx)||0)+" y: "+(Math.round(a.snake.yy)||0)),a.goalCoordinates&&(b.push("target"),b.push("x: "+a.goalCoordinates.x+" y: "+a.goalCoordinates.y),a.goalCoordinates.sz&&b.push("sz: "+a.goalCoordinates.sz)),void 0!==a.bso&&userInterface.overlays.serverOverlay.innerHTML!==a.bso.ip+":"+a.bso.po&&(userInterface.overlays.serverOverlay.innerHTML=a.bso.ip+":"+a.bso.po)),userInterface.overlays.botOverlay.innerHTML=b.join("<br/>"),a.playing&&a.visualDebugging&&a.goalCoordinates&&bot.isBotEnabled){var c={x:a.snake.xx,y:a.snake.yy};canvas.drawLine(c,a.goalCoordinates,"green"),canvas.drawCircle(a.goalCoordinates,"red",!0)}},oefTimer:function(){var b=Date.now();canvas.maintainZoom(),e(),f(),a.playing&&bot.isBotEnabled&&null!==a.snake?(a.onmousemove=function(){},bot.isBotRunning=!0,bot.go()):bot.isBotEnabled&&bot.isBotRunning&&(bot.isBotRunning=!1,a.lastscore&&a.lastscore.childNodes[1]&&(bot.scores.push(parseInt(a.lastscore.childNodes[1].innerHTML)),bot.scores.sort(function(a,b){return b-a}),userInterface.updateStats()),a.autoRespawn&&bot.connect()),bot.isBotEnabled&&bot.isBotRunning||(a.onmousemove=g),userInterface.onFrameUpdate(),setTimeout(userInterface.oefTimer,1e3/bot.opt.targetFps-(Date.now()-b))},quit:function(){a.playing&&a.resetGame&&(a.want_close_socket=!0,a.dead_mtm=0,a.play_btn&&a.play_btn.setEnabled(!0),a.resetGame())},handleTextColor:function(a){return'<span style="color:'+(a?'green;">enabled':'red;">disabled')+"</span>"}}}(window,document);!function(a,b){a.play_btn.btnf.addEventListener("click",userInterface.playButtonClickListener),b.onkeydown=userInterface.onkeydown,a.onmousedown=userInterface.onmousedown,a.addEventListener("mouseup",userInterface.onmouseup),userInterface.hideTop(),userInterface.initServerIp(),userInterface.server.addEventListener("keyup",function(b){13===b.keyCode&&(b.preventDefault(),a.play_btn.btnf.click())}),userInterface.initOverlays(),userInterface.loadPreference("logDebugging",!1),userInterface.loadPreference("visualDebugging",!1),userInterface.loadPreference("autoRespawn",!1),userInterface.loadPreference("mobileRender",!1),a.nick.value=userInterface.loadPreference("savedNick","Slither.io-bot"),b.body.addEventListener("mousewheel",canvas.setZoom),b.body.addEventListener("DOMMouseScroll",canvas.setZoom),a.mobileRender?userInterface.toggleMobileRendering(!0):userInterface.toggleMobileRendering(!1),a.localStorage.setItem("edttsg","1"),a.social.remove(),setInterval(userInterface.framesPerSecond.fpsTimer,80),userInterface.oefTimer()}(window,document);
